# Data Model: HR RAG Frontend

**Feature**: HR RAG Frontend Interface
**Date**: 2026-01-21
**Source**: Derived from spec.md Key Entities section

## Overview

This document defines the TypeScript interfaces and types used in the Angular 21 frontend application. All models are client-side representations that map to backend API responses or localStorage data.

## Core Entities

### Question

A text query submitted by a user through the chat interface.

```typescript
interface Question {
  text: string;           // The question text (validated: non-empty, max 1000 chars)
  timestamp: Date;        // When the question was asked
}
```

**Validation Rules**:
- `text`: Required, non-empty, max 1000 characters
- `timestamp`: Auto-generated on creation

**Lifecycle**: Created when user submits question → Sent to backend API → Stored in conversation history

---

### Answer

A text response generated by the backend RAG system.

```typescript
interface Answer {
  content: string;                    // The answer text
  sources: SourceDocumentReference[]; // Documents used to generate answer
  timestamp: Date;                    // When the answer was received
  isStreaming?: boolean;              // True while streaming in progress
}
```

**Relationships**:
- Has many `SourceDocumentReference` (0 to N sources)

**State Transitions**:
- `isStreaming: true` → Receiving SSE chunks → `isStreaming: false` → Complete

---

### SourceDocumentReference

A reference to a document used to generate an answer.

```typescript
interface SourceDocumentReference {
  documentName: string;   // Display name of the source document
  excerpt: string;        // Relevant text excerpt from the document
}
```

**Relationships**:
- Belongs to `Answer`

**Validation Rules**:
- `documentName`: Required, non-empty
- `excerpt`: Optional (may be empty if backend doesn't provide)

---

### ConversationMessage

A single question-answer pair in the chat history.

```typescript
interface ConversationMessage {
  id: string;             // Unique identifier (UUID)
  question: Question;     // The user's question
  answer: Answer;         // The system's answer
  timestamp: Date;        // Message pair timestamp (inherited from question)
}
```

**Relationships**:
- Has one `Question`
- Has one `Answer`

**Storage**: Persisted in browser localStorage (max 50 messages, FIFO eviction)

**Lifecycle**: Created when Q&A pair completes → Stored in localStorage → Displayed in UI → Evicted when limit exceeded

---

### Document

An uploaded file (PDF or TXT) stored in the backend system.

```typescript
interface Document {
  id: string;                       // Unique identifier from backend
  filename: string;                 // Display name (editable)
  fileType: 'PDF' | 'TXT';         // File type enum
  fileSizeBytes: number;            // File size in bytes
  status: DocumentStatus;           // Indexing status
  uploadTimestamp: Date;            // When document was uploaded
  failureReason?: string;           // Error message if status is FAILED
}

enum DocumentStatus {
  PENDING = 'pending',   // Being indexed
  INDEXED = 'indexed',   // Ready for use
  FAILED = 'failed'      // Indexing error occurred
}
```

**Validation Rules**:
- `filename`: Required, non-empty, max 255 characters
- `fileType`: Must be 'PDF' or 'TXT'
- `fileSizeBytes`: Must be > 0 and <= 10MB (10,485,760 bytes)
- `status`: Must be one of PENDING, INDEXED, FAILED

**State Transitions**:
```
PENDING → INDEXED (success)
PENDING → FAILED (error)
FAILED → PENDING (manual retry)
```

**Operations**:
- **Create**: Upload new document (POST /api/documents)
- **Read**: List all documents (GET /api/documents)
- **Update** (rename): DELETE + POST with new filename
- **Update** (replace file): DELETE + POST with new file
- **Delete**: Remove document (DELETE /api/documents/{id})

---

### UploadProgress

Temporary state tracking file upload completion.

```typescript
interface UploadProgress {
  filename: string;       // File being uploaded
  percentComplete: number; // Upload percentage (0-100)
  status: UploadStatus;   // Current upload status
  bytesTransferred: number; // Bytes uploaded so far
  totalBytes: number;     // Total file size
  errorMessage?: string;  // Error if status is ERROR
}

enum UploadStatus {
  UPLOADING = 'uploading',
  PROCESSING = 'processing', // Backend is processing
  COMPLETE = 'complete',
  ERROR = 'error'
}
```

**Lifecycle**: Created on file selection → Updated during upload → Converted to `Document` on completion → Discarded

**State Transitions**:
```
UPLOADING → PROCESSING → COMPLETE (success)
UPLOADING → ERROR (upload failure)
PROCESSING → ERROR (backend rejection)
```

---

## API Request/Response Models

### ChatRequest

```typescript
interface ChatRequest {
  question: string;       // The user's question
}
```

**API Endpoint**: `POST /api/chat` (blocking) or `POST /api/chat/stream` (SSE)

---

### ChatResponse (Blocking)

```typescript
interface ChatResponse {
  answer: string;                    // The generated answer
  sources: SourceDocumentReference[]; // Source documents
}
```

**API Endpoint**: `POST /api/chat`

---

### ChatStreamEvent (SSE)

```typescript
interface ChatStreamEvent {
  chunk: string;          // Text chunk for streaming
  sources?: SourceDocumentReference[]; // Sources (sent with final chunk)
  done: boolean;          // True for final event
}
```

**API Endpoint**: `POST /api/chat/stream` (Server-Sent Events)

---

### DocumentListResponse

```typescript
interface DocumentListResponse {
  documents: Document[];
}
```

**API Endpoint**: `GET /api/documents`

---

## localStorage Schema

### Conversation History

**Key**: `hr-assistant-conversations`

**Value Structure**:
```typescript
interface ConversationHistory {
  messages: ConversationMessage[]; // Max 50 messages
  lastUpdated: Date;
}
```

**Storage Management**:
- Max 50 messages (FIFO eviction)
- Estimated size: ~5KB per message → ~250KB total
- Fallback: If localStorage unavailable (private browsing), use in-memory only

---

## Validation Summary

| Entity | Field | Rule |
|--------|-------|------|
| Question | text | Non-empty, max 1000 chars |
| Document | filename | Non-empty, max 255 chars |
| Document | fileSizeBytes | > 0, <= 10,485,760 (10MB) |
| Document | fileType | 'PDF' or 'TXT' only |
| UploadProgress | percentComplete | 0-100 |
| ConversationHistory | messages.length | Max 50 |

---

## Error Handling

### Common Error Types

```typescript
interface ApiError {
  status: number;         // HTTP status code
  message: string;        // User-friendly error message
  details?: string;       // Technical details (optional)
}

// Common HTTP status codes
// 400: Bad Request (invalid file, question too long)
// 404: Not Found (document doesn't exist)
// 413: Payload Too Large (file > 10MB)
// 500: Internal Server Error (backend failure)
// 503: Service Unavailable (backend down, Ollama unavailable)
```

---

## Notes

- All timestamps are ISO 8601 strings when serialized to localStorage/API
- UUIDs use `crypto.randomUUID()` for client-side generation
- File sizes use bytes (not KB/MB) for precision
- Document IDs are backend-generated (opaque strings)
- localStorage keys prefixed with `hr-assistant-` to avoid conflicts
