<div class="message-list-container">
  <!-- SVG Gradient Definition -->
  <svg width="0" height="0" style="position: absolute;">
    <defs>
      <linearGradient id="gemini-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#4285f4"/>
        <stop offset="33%" style="stop-color:#9b72cb"/>
        <stop offset="66%" style="stop-color:#d96570"/>
        <stop offset="100%" style="stop-color:#d96570"/>
      </linearGradient>
    </defs>
  </svg>

  @if (messages().length === 0 && !isLoading() && !streamingContent()) {
    <!-- Empty State - Gemini style -->
    <div class="empty-state">
      <div class="greeting-icon">
        <svg viewBox="0 0 28 28" fill="none">
          <path d="M14 0L17.5 10.5L28 14L17.5 17.5L14 28L10.5 17.5L0 14L10.5 10.5L14 0Z" fill="url(#gemini-gradient)"/>
        </svg>
      </div>
      <h3>Bonjour, comment puis-je vous aider ?</h3>
      <p>Posez une question sur les ressources humaines, je suis là pour vous accompagner</p>

      <!-- Suggested Questions -->
      <div class="suggested-questions">
        @for (question of suggestedQuestions; track question) {
          <button class="suggestion-chip" (click)="suggestionClicked.emit(question)">
            {{ question }}
          </button>
        }
      </div>
    </div>
  } @else {
    <!-- Message List with Scroll -->
    <div class="messages-scroll" #scrollContainer>
      @for (message of messages(); track message.id) {
        <div class="message-group">
          <!-- User Question -->
          <div class="message message-user">
            <div class="message-content">
              <p>{{ message.question.text }}</p>
            </div>
          </div>

          <!-- Assistant Answer -->
          <div class="message message-assistant">
            <div class="assistant-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M12 0L14.7 9.3L24 12L14.7 14.7L12 24L9.3 14.7L0 12L9.3 9.3L12 0Z" fill="url(#gemini-gradient)"/>
              </svg>
            </div>
            <div class="message-wrapper">
              <div class="message-content markdown-content">
                <markdown [data]="message.answer.content"></markdown>
              </div>
              <!-- Message Actions -->
              <div class="message-actions">
                <button
                  class="action-button"
                  (click)="copyToClipboard(message.answer.content, message.id)"
                  [pTooltip]="copiedMessageId() === message.id ? 'Copié !' : 'Copier'"
                  tooltipPosition="top">
                  @if (copiedMessageId() === message.id) {
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 6L9 17l-5-5"/>
                    </svg>
                  } @else {
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                      <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                  }
                </button>
              </div>
              <!-- Source Documents -->
              <app-source-list [sources]="message.answer.sources"></app-source-list>
            </div>
          </div>
        </div>
      }

      <!-- Pending Question (shown during loading/streaming) -->
      @if (pendingQuestion() && (isLoading() || streamingContent())) {
        <div class="message-group">
          <div class="message message-user">
            <div class="message-content">
              <p>{{ pendingQuestion() }}</p>
            </div>
          </div>
        </div>
      }

      <!-- Streaming Message (shown during loading/streaming) -->
      @if (isLoading() || streamingContent()) {
        <div class="message message-assistant message-streaming">
          <div class="assistant-icon">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 0L14.7 9.3L24 12L14.7 14.7L12 24L9.3 14.7L0 12L9.3 9.3L12 0Z" fill="url(#gemini-gradient)"/>
            </svg>
          </div>
          <div class="message-wrapper">
            <div class="message-content markdown-content">
              @if (streamingContent()) {
                <markdown [data]="streamingContent()"></markdown>
              }
              <span class="streaming-cursor"></span>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
