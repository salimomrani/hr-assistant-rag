<div class="document-selector">
  <!-- Collapsed Header -->
  <button
    class="selector-header"
    (click)="toggleExpanded()"
    [attr.aria-expanded]="isExpanded()"
    aria-controls="document-list">
    <div class="header-content">
      <svg class="icon-document" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
      </svg>
      <span class="summary-text">{{ selectionSummary() }}</span>
    </div>
    <svg
      class="icon-chevron"
      [class.expanded]="isExpanded()"
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2">
      <polyline points="6 9 12 15 18 9"/>
    </svg>
  </button>

  <!-- Expanded Document List -->
  @if (isExpanded()) {
    <div id="document-list" class="document-list" role="listbox" aria-label="Select documents">
      <!-- Select All Toggle -->
      @if (indexedDocuments().length > 0) {
        <div class="select-all-row">
          <button
            class="select-all-btn"
            (click)="toggleAll()"
            [attr.aria-pressed]="allSelected()">
            @if (allSelected()) {
              <span>Deselect all</span>
            } @else {
              <span>Select all</span>
            }
          </button>
        </div>
      }

      <!-- Document Items -->
      @for (doc of indexedDocuments(); track doc.id) {
        <label class="document-item" [class.selected]="isSelected(doc.id)">
          <p-checkbox
            [binary]="true"
            [ngModel]="isSelected(doc.id)"
            (ngModelChange)="toggleDocument(doc.id)"
            inputId="doc-{{ doc.id }}">
          </p-checkbox>
          <span class="document-name" [pTooltip]="doc.filename" tooltipPosition="top">
            {{ doc.filename }}
          </span>
        </label>
      } @empty {
        <div class="empty-state">
          <span>No indexed documents available</span>
        </div>
      }
    </div>
  }
</div>
